<!DOCTYPE html>

<html lang="es">
    
    <head>
        <meta charset="utf-8">
        <title> Formulario de Sitio Turistico </title> 
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/custom.css">  
    </head>

    <body class="daweb">
      <header class="p-3 bg-dark text-white">
        <div class="container-fluid">
          <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="/" class="logo d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
              <svg height="64px" width="64px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 254.019 254.019" xml:space="preserve" fill="#4e5a0c" stroke="#4e5a0c" transform="matrix(1, 0, 0, 1, 0, 0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g> <g> <path style="fill:#F3F9D2;" d="M126.514,48.282c-43.428,0-78.738,35.319-78.738,78.738c0,43.389,35.309,78.718,78.738,78.718 c43.389,0,78.738-35.329,78.738-78.708C205.252,83.601,169.932,48.282,126.514,48.282z M126.514,198.898 c-39.647,0-71.879-32.232-71.879-71.869s32.222-71.928,71.879-71.928s71.879,32.29,71.879,71.928 S166.171,198.898,126.514,198.898z M193.352,127.029c0,36.882-29.926,66.808-66.828,66.808 c-36.912,0-66.838-29.936-66.838-66.808c0-36.921,29.936-66.847,66.838-66.847C163.426,60.172,193.352,90.108,193.352,127.029z M41.308,56.733l0.02,38.836h-0.059c-0.391,12.389-13.971,17.117-13.971,17.117v24.924h0.02l-0.02,57.312 c0,0-5.491,7.093-12.604,0v-82.226h0.166c-8.285-3.527-14.411-4.748-14.802-17.117H0V56.733l6.224-0.029L9.252,94.28H16.6 l0.928-38.348h5.989l0.723,38.348h8.617l1.983-37.547L41.308,56.733L41.308,56.733z M252.1,122.857h-15.232v77.038h-17.596 V54.144h17.596C236.878,54.134,260.844,84.548,252.1,122.857z"></path> </g> </g> </g> </g></svg>
            </a>
    
            <h1 class="col text-white"> Añadir sitios turisticos </h1>
    
            <!-- mostrar si logueado -->
            <div class="text-end">
                    <span class="nav-link px-2 text-white">{{ userName }}</span>
                    <a href="/logout" type="button" class="btn btn-outline-light me-2">Logout</a>
            </div>
            <div class="flex-shrink-0 dropdown">
              <a href="#" class="d-block link-secondary text-decoration-none dropdown-toggle" id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="//picsum.photos/32" alt="mdo" width="32" height="32" class="rounded-circle">
              </a>
              <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2" style="">
                <li><span class="dropdown-item fw-bold">Administración</span></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/restaurantes">Lista Restaurantes</a></li>
                {{#if userRol}}
                <li><a class="dropdown-item" href="/gestRestaurante">Gestionar Restaurantes</a></li>
                {{/if}}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/logout">Salir</a></li>
              </ul>
            </div>
          </div>
        </div>
      </header>
        <div class="container">
          
          <!-- La primera parte no la veo necesaria -->
          <!--  <main class="shadow border mt-4 p-4">
                <h1>Sitio turístico:</h1>
                <form>
                    <div class="mb-2">
                        <label for="titulo" class="form-label">Título:</label>
                        <input type="text" id="titulo" class="form-control" name="titulo" placeholder="titulo" required />
                    </div>
                    <div class="mb-2">
                        <label for="url" class="form-label">Dirección Web:</label>
                        <input type="url" id="url" class="form-control" name="url" placeholder="https://" required />
                    </div>
                    <div class="mb-2">
                        <label for="coords" id="coords" class="form-label">Coordenadas:</label>
                        <div class="row">
                            <div class="col">
                                <input type="text" id="latitud" class="form-control" name="latitud" placeholder="Latitud" required aria-labelledby="coords" />
                            </div>
                            <div class="col">
                                <input type="text" id="longitud" class="form-control" name="longitud" placeholder="Longitud" required  aria-labelledby="coords" />
                            </div>
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-primary">Registrar</button>
                        <button type="submit" class="btn btn-light">Modificar</button>
                        <button type="reset" class="btn btn-light">Borrar</button>
                    </div>
                </form>
            </main> -->
            <!-- End La primera parte no la veo necesaria -->
          <main class="shadow border mt-4 p-4">
                <h1>Listado de sitios turísticos:</h1>
                <div class="row" id="addsitiosError">{{message}}</div>
                <form id="addsitios">
                  {{#if sitiosTuristicos}}
                    <div class="table-responsive">
                        <table id="listSelect" name="listSelect"  class="table table-sm caption-top table-success table-striped">
                            <caption>Listado de sitios turísticos</caption>
                            <thead>
                                <tr>
                                  <th scope="col">#</th>
                                  <th scope="col">Nombre</th>
                                  <th scope="col">Ciudad</th>
                                </tr>
                            </thead>
                            <tbody>
                              {{#each sitiosTuristicos}}
                                <tr>
                                    <td>
                                      <!-- el id tiene que cambiar, con el name igual con [] manda array (en PHP)-->
                                      <input class="form-check-input" name="sitioTuristico[]" type="checkbox" id={{id}} value="idDelSitio" aria-label="Selecciona este sitio">
                                    </td>
                                    <td>{{nombre}}</td>
                                    <td>{{ciudad}}</td>
                                  </tr>
                                {{/each}}
                            </tbody>
                        </table>
                      </div>
                    <div>
                        <button type="submit" class="btn btn-primary">Añadir</button>   <!--TODO: Pendiente, deberia ser un post-->
                        <a href="/modRestaurante/{{restauranteId}}/" class="btn btn-light">Volver</a> <!--TODO: tiene que llevar el id del restaurante, para eso le tiene que llegar aqui-->
                    </div>
                  {{/if}} 
                </form>
                <script>
                    document.getElementById('addsitios').addEventListener('submit', async (event) => {
                        event.preventDefault();
                        const form = document.getElementById('addsitios');
                        const formData = new FormData(form);
                        formData.append("listsitiosTuristicos", '{{sitiosTuristicos}}');
                        formData.append("restauranteId", '{{restauranteId}}');
                        document.getElementById('addsitiosError').innerHTML = "";
                        fetch('/addsitios', {
                            method: "POST",
                            headers: {"Content-Type": "application/json; charset=UTF-8"},
                            body: JSON.stringify(Object.fromEntries(formData.entries()))
                        })
                            .then((response) => {
                                if (response.status !== 200 ) {
                                    document.getElementById('addsitiosError')
                                        .innerHTML = `<div class="alert alert-danger" role="alert">ERROR al crear</div>`;
                                } else {
                                    return Promise.resolve(response.json());
                                }
                            }) 
                            .then((json) => {
                                document.getElementById('addsitios')
                                    .innerHTML = `<div class="alert alert-success" role="alert">${json.message}</div>`
                            });
                    });
                </script>
            </main>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>          
    </body>
</html>